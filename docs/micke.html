<!doctype html>
<!--[if lt IE 7 ]> <html lang="en" class="ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!--> <html lang="en"> <!--<![endif]-->
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <style>
        html, body {
            height: 100vh;
        }
        body{
            overflow: hidden;
            margin:0;
            padding:0;
        }

        #container
        {
            display: flex;
            flex-flow: column;
            height: 100vh;
        }

        /*
        #wrapper
        {
            position:absolute;
        }*/
        #flipbook
        {
    
        }
        
        #flipbook div
        {
            width: 922px;
		    height: 600px;	
        }

        #flipbook div img
        {
            width: 100%;
		    height: 100%;	
        }  
        
        #flipbook .page-wrapper
        {
            border: 1px solid black;
            transition: border-width 1s linear;
        }

        .hiddenfirst
        {
            opacity:0;
        }
        #topbar {
            height: 25px; 
            margin: 0px auto !important;
            
        }

        #buttons-container
        {
            background-color: #005aa9;
            display: inline-block; 
            padding: 0px 30px;
            border-radius: 14px;
        }

        #logo
        {
            height: 20px;
        }

        #topbar button
        {
            height: 16px;
            background-color: transparent;
            border: 0;
            padding: 0px 20px;
            position: relative;
            top: -3px;
            color: yellow;
            cursor: pointer;
        }

        #topbar a
        {
            padding: 0px 20px;
            position: relative;
            top: -2px;
            color: yellow;
            cursor: pointer;
            text-decoration: none;
        }

        #topbar a:visited
        {
            color: yellow;
        }        

        .flipbook div
        {
            width: 922px;
            height: 600px;		
        }   
        
        #flipcontainer
        {
            flex-grow : 1;
        }

    </style>
    <script type="text/javascript" src="src/jquery.min.1.7.js"></script>
    <script type="text/javascript" src="src/modernizr.2.5.3.min.js"></script>
    <link href="fontawesome/css/fontawesome.css" rel="stylesheet">
    <link href="fontawesome/css/solid.css" rel="stylesheet">     
    <script src="src/turn.min.js"></script>
</head>
<body>
    <div id="container" class="hiddenfirst">
        <div id="topbar">
            <span id="buttons-container">
                <span><img id="logo" src="imgs/ikeanimation.png" /></span>
            
                <button id="btnFullscreen">
                    <i id="fullscreenIcon" class="fa-solid fa-up-right-and-down-left-from-center"></i>
                </button>
                <span>
                    <a href="ikea-demo.html">
                        <i class="fa-solid fa-video"></i>
                    </a>
                </span>
                <span>
                    <a href="micke-desk-oak-effect__AA-476633-11-2.pdf">
                        <i class="fa-solid fa-file-pdf"></i>
                    </a>
                </span>	            
            </span>

        </div>
        <div id="flipcontainer">
            <div id="flipbook">
                <div>
                    <img src="imgs/micke-book/micke-0.png" />
                </div>
                <div>
                    <img src="imgs/micke-book/micke-1.png" />
                </div>
                <div>
                    <img src="imgs/micke-book/micke-2.png" />
                </div>
                <div>
                    <img src="imgs/micke-book/micke-3.png" />
                </div>
                <div>
                    <img src="imgs/micke-book/micke-4.png" />
                </div>
                <div>
                    <img src="imgs/micke-book/micke-5.png" />
                </div>
                <div>
                    <img src="imgs/micke-book/micke-6.png" />
                </div>
                <div>
                    <img src="imgs/micke-book/micke-7.png" />
                </div>
                <div>
                    <img src="imgs/micke-book/micke-8.png" />
                </div>
                <div>
                    <img src="imgs/micke-book/micke-9.png" />
                </div>
                <div>
                    <img src="imgs/micke-book/micke-10.png" />
                </div>
                <div>
                    <img src="imgs/micke-book/micke-11.png" />
                </div>
                <div>
                    <img src="imgs/micke-book/micke-12.png" />
                </div>
                <div>
                    <img src="imgs/micke-book/micke-13.png" />
                </div>
                <div>
                    <img src="imgs/micke-book/micke-14.png" />
                </div>
                <div>
                    <img src="imgs/micke-book/micke-15.png" />
                </div>
                <div>
                    <img src="imgs/micke-book/micke-16.png" />
                </div>
                <div>
                    <img src="imgs/micke-book/micke-17.png" />
                </div>
                <div>
                    <img src="imgs/micke-book/micke-18.png" />
                </div>
                <div>
                    <img src="imgs/micke-book/micke-19.png" />
                </div>
                <div>
                    <img src="imgs/micke-book/micke-20.png" />
                </div>
                <div>
                    <img src="imgs/micke-book/micke-21.png" />
                </div>
                <div>
                    <img src="imgs/micke-book/micke-22.png" />
                </div>
                <div>
                    <img src="imgs/micke-book/micke-23.png" />
                </div>
                <div>
                    <img src="imgs/micke-book/micke-24.png" />
                </div>
                <div>
                    <img src="imgs/micke-book/micke-25.png" />
                </div>
                <div>
                    <img src="imgs/micke-book/micke-26.png" />
                </div>
                <div>
                    <img src="imgs/micke-book/micke-27.png" />
                </div>
            </div>
        </div>
    </div>

    <script>
        var pageflipsound = new Audio('page-flip-01a.mp3');
        var basewidth = 922;
        var baseheight = 600;
        
        function iOS() {
            return [
                'iPad Simulator',
                'iPhone Simulator',
                'iPod Simulator',
                'iPad',
                'iPhone',
                'iPod'
            ].includes(navigator.platform)
            // iPad on iOS 13 detection
            || (navigator.userAgent.includes("Mac") && "ontouchend" in document)
        }
        /*
       $( window ).load(function() {
  // Run code
}); 
        */
        //$(document).ready(function(){
        $(window).load(function(){
            if(iOS())
            {
                $("#btnFullscreen").css({ display:"none" });
            }
            else
            {
                $("#btnFullscreen").css({ display:"inline-block" });
            }

            // Create the flipbook
            $('#flipbook').turn({
                    // Width
                    width:basewidth,
                    // Height
                    height:baseheight,
                    // Elevation
                    elevation: 50,
                    // Enable gradients
                    gradients: true,
                    // Auto center this flipbook
                    autoCenter: false,
                    when: {
                        turning: function (e, page, pageObj){
                            pageflipsound.play();
                        }
                    }
            });
            
            var i=0, maxTries = 10, intervalms=50;
            //check that the flipbook is initialized before adjusting sizes and showing it
            var timer = setInterval(function() {
                if($('.flipbook').turn)
                {
                    console.log("(" + i + ") Flipbook READY");
                    clearInterval(timer);
                    readjustZoom();
                    $(".hiddenfirst").animate({opacity: 1}, 400);
                }
                else
                {
                    console.log("(" + i + ") Flipbook not ready...")
                }
                i++;
                if (i === maxTries){
                    clearInterval(timer);
                    console.log("Could not load the Flipbook within " + maxTries + " cycles of " + intervalms + "msec");
                }
                console.log("Loaded the Flipbook within " + i + " cycles of " + intervalms + "msec");
            }, intervalms);            
        });

        $(window).resize(function(){
            readjustZoom();
        });

       // document.addEventListener("orientationchange", function (event) {
       //     alert("orientation!");
       //     readjustZoom();
       // });

        var portrait = window.matchMedia("(orientation: portrait)");
        portrait.addEventListener("change", function(e) {
            

            var orientation = window.orientation;

// Look at the value of window.orientation:

if (orientation === 0) {

    // device is in Portrait mode.

} else if (orientation === 90) {

    // device is in Landscape mode. The screen is turned to the left.

    $('body').animate({
        scrollTop: '0'
    }, 0);

} else if (orientation === -90) {

    // device is in Landscape mode. The screen is turned to the right.

    $('body').animate({
        scrollTop: '0'
    }, 0);
    
}            
readjustZoom();
        });

        $("#btnFullscreen").click(
		function() {
            var doc = window.document;
            var docEl = document.body;
            var requestFullScreen = docEl.requestFullscreen || docEl.mozRequestFullScreen || docEl.webkitRequestFullScreen || docEl.msRequestFullscreen;
            var cancelFullScreen = doc.exitFullscreen || doc.mozCancelFullScreen || doc.webkitExitFullscreen || doc.msExitFullscreen;

			if(!doc.fullscreenElement && !doc.mozFullScreenElement && !doc.webkitFullscreenElement && !doc.msFullscreenElement){
                requestFullScreen.call(docEl);
			} else {
				cancelFullScreen.call(doc);
			}
			togglefullscreenbutton();
		}
	);        

	["", "webkit", "moz", "ms"].forEach(
    	prefix => document.addEventListener(prefix+"fullscreenchange", togglefullscreenbutton, false)
	);

    function togglefullscreenbutton()
    {
        if (!document.fullscreenElement) {
            $("#fullscreenIcon").addClass("fa-up-right-and-down-left-from-center");
            $("#fullscreenIcon").removeClass("fa-down-left-and-up-right-to-center");
        }
        else
        {
            $("#fullscreenIcon").addClass("fa-down-left-and-up-right-to-center");
            $("#fullscreenIcon").removeClass("fa-up-right-and-down-left-from-center");
        }
    }    
        function readjustZoom()
        {
            console.log("--------------------------------------");
            var win = $(this);
            var h = win.height() -30;
            var w = win.width();
            //var h = $("#flipcontainer").height();
            //var w = $("#flipcontainer").width();
            var newhight = 0;

            //var readjustableElement = $('#flipbook');
            var readjustableElement = $('#flipbook');

            var widthRatio = (basewidth )/ w ;
            var heightRatio = (baseheight) / h ;
            var toolbarontheside = true;
            if(heightRatio > widthRatio) {
                // scale image to match the height, and let the width have the gaps
                newhight = h/baseheight;
                console.log("scale to height (sides with gaps)");
                toolbarontheside = true;
            } else {
                // scale image to match the width, and let the height have the gaps
                newhight = w/basewidth;
                console.log("scale to width (top and bottom with gaps)");
                toolbarontheside = false;
            }
            console.log("Zooming to " + newhight + "(flip container h: " + $("#flipcontainer").height() + ")");
            if($('#flipbook').turn)
                $('#flipbook').turn('zoom', newhight);
            else
                console.log("Not initialized...");


            var leftmarg = (w - readjustableElement.width())/2;
            var topmarg = (h - readjustableElement.height())/2;
            //console.log("leftmarg calculated " + leftmarg + ", topmarg calculated " + topmarg);
            //console.log("margins: " + tmarg+"px " + lmarg + "px " + bmarg + "px " + rmarg +"px");
            readjustableElement.css({ margin: topmarg + "px " + leftmarg + "px" });
            //$("#flipcontainer").css({ padding: topmarg + "px " + leftmarg + "px" });
            return;
            //console.log("Setting toolbar to left: " +  ($('.flipbook').width() + $('.flipbook').offset().left));
            if(toolbarontheside)
            {
                $("#toolbar").addClass("toolbar_vertical");
                $("#toolbar").removeClass("toolbar_horizontal");

                var 
                    toppos = ($('#flipbook').height() + $('#flipbook').offset().top)/2 - ($("#toolbar").height()/2),
                    leftpos = $('#flipbook').width() + $('#flipbook').offset().left;
                $("#toolbar").css({ top: toppos + "px", left: leftpos +"px"});
            }
            else
            {
                $("#toolbar").addClass("toolbar_horizontal");
                $("#toolbar").removeClass("toolbar_vertical");

                var 
                    toppos = $('#flipbook').height() + $('#flipbook').offset().top,
                    leftpos = ($('#flipbook').width() + $('#flipbook').offset().left)/2 - ($("#toolbar").width()/2);		
                $("#toolbar").css({ top: toppos + "px", left: leftpos +"px"});
            }

            console.log("=============================-");
        }        
    </script>
</body>
</html>

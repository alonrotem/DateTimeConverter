<!--
Changelog
Colors of the logo and chapters and micke book top bar
mouse hiding controls better
links from vide to booklet

TODO
draggable progress
popup QR
-->

<!DOCTYPE html> 
<html> 
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="imgs/ikea.png">
  <link href="fontawesome/css/fontawesome.css" rel="stylesheet">
  <!--<link href="fontawesome/css/brands.css" rel="stylesheet">-->
  <link href="fontawesome/css/solid.css" rel="stylesheet"> 
  <script src="src/jquery.min.js"></script>
  <script src="src/jquery-ui.min.js"></script>
  <style>
    body
    {
      /*overflow: hidden;*/
      font-family: Arial, Helvetica, sans-serif;
      /*background-color: gold;*/
    }
    html, body
    {
      height: 100%;

    }

    *
    {
        margin:0;
        padding:0;
    }

    #videowrapper
    {
        width: 100vw; 
        height: 100%;
        max-width: 177.78vh; /* 16/9 = 1.778 */
        margin: auto;
        position: absolute;
        top:0;bottom:0; /* vertical center */
        left:0;right:0; /* horizontal center */

        /*display: grid;*/
        grid-template-columns: auto 250px;
        grid-template-rows: 75px auto;   
    }


    #customcontrols-visible
    {
      display: block;
    }

    .speed-control
    {
      background: black;
      color: white;
      padding: 8px;
      border-radius: 25px;
      display: inline-block;
      width: 38px;
      text-align: center;
      cursor: pointer;
      font-size: 1.3vw;
      font-weight: bold;
      margin-left: 10px;      
    }

    .progressbar
    {
      height: 5px;
      background-color: white;
      width: 95%;
      border-radius: 5px;
      position: absolute;
      margin: 0% 2.5%;
      bottom: 35px;
      box-shadow: 0px 0px 20px black;
    }

    #playnav
    {
      position: absolute;
      top: 40%;
      /*left: 50%;*/
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
    }

    #playnav *, .progressbar *
    {
      visibility: hidden;
    }

    #customplaypause
    {
      font-size: 5vw;
      cursor: pointer;
      /*margin: 0px 38px;*/
    }

    .custom-control i
    {
      text-shadow: 0 0 75px black, 0 0 75px black;
      color: white;
    }

    #chaptercontainer
    {
      grid-row-start: 2;
      grid-column-start: 2;
      z-index: 2000;
      display: none;
    }
    



    #progressindicator {
      position: absolute;
      top: -5px;
      left: 0px;
      color: #fbe724;
    }

    #watchedbar {
      background-color: #fbe724;
      position: absolute;
      top: 0px;
      height: 5px;
      width: 0px;
    }
    #chapterbar {
      position: absolute; 
      top: 0px;
      width: 100%;
    }
    .progress-chapter
    {
      width: 5px; 
      height: 5px; 
      background: #0024C3;
      position: absolute;
      top: 0px;
    }

    #prevlinkBtn, #nextlinkBtn
    {
      color: #0024C3;
    }

    #logo
    {
      position: absolute;
      padding: 20px 10px;
    }
    #logo img
    {
      width: 30%;

    }

    .activespeed
      {
        background-color: #fbe724;
        color: black;
      }
    @media all and (orientation:portrait)  {
    /* Style adjustments for portrait mode goes here */
    .speed-control
      {
        font-size: 2.0vw;
        padding: 2px;
        font-weight: bold;
        margin-left: 5px;             
        }    

        #additionalLinksPanel{
          top: 20px !important;
          margin-left: 5px !important;  
        }

        #additionalLinksPanel a {
          font-size: 15px !important;
        }

        #additionalLinksPanel div {
          margin: 7px 0px !important;
          font-size: 15px !important;
        }

        #fullscreenicon
        {
          font-size: 15px !important;
        }


    }

    @media (orientation: landscape) and (hover: none) and (pointer: coarse) {
      /* Style adjustments for landscape mode goes here */
      #logo
      {
        padding: 50px 10px;

      }
      #speedpanel
      {
        top: 30px !important;

        position:absolute;
      }
      .speed-control
      {
        font-size: 1.7vw;
        padding: 2px;
      
      }

      #additionalLinksPanel{
      top: 50px !important;
    }

      #additionalLinksPanel div {
        margin: 15px 0px !important;
      }

      #additionalLinksPanel a {
      font-size: 25px !important;
    }

    #fullscreenicon
    {
      font-size: 25px !important;
    }

    .modal {
  padding-top: 0px !important; /* Location of the box */
    }

    }
    
    #progresselapsed
    {
      position: absolute;
    top: -20px;
      color: black;
    }

    #progresstotal {
      position: absolute;
    top: -20px;
    right: 0px;
      color: black;
    }

    #speedpanel
    {
      position:absolute;
      top: 0;
      right: 0;
      margin: 20px 10px;
    }

    #currentchapterindicator
    {
      background: #fbe724;
    /* display: inline-block; */
    position: absolute;
    padding: 10px;
    display:none;
    }

    #previouslink, #nextlink, #currentchapterindicator, #progresselapsed, #progresstotal
    {
      -webkit-touch-callout: none; /* Safari */
        -webkit-user-select: none; /* Chrome */     
           -moz-user-select: none; /* Firefox */
            -ms-user-select: none; /* Internet Explorer/Edge */
                user-select: none; 
    }

    #additionalLinksPanel{
      position:absolute; 
      top: 100px;
      right: 0; 
      margin: 20px 10px;
    }

    #additionalLinksPanel div {
      margin: 20px 0px;
      text-align: center;
      color: #0024C3;
    }

    #additionalLinksPanel a {
      font-size: 40px;
      color: #0024C3;
      text-decoration: none;
    }

    #additionalLinksPanel a:visited {
      color: #0024C3;
    }

    #fullscreenicon
    {
      font-size: 40px;
    }


/* The Modal (background) */
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  padding-top: 100px; /* Location of the box */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content */
.modal-content {
  background-color: #fefefe;
  margin: auto;
  padding: 20px;
  border: 1px solid #888;
  width: 50%;
}   

#modal-table
{
  width: 100%;
  border: 0px;
}
#modal-table td
{
  width:50%;
  border: 0px;
  text-align:center;
}

#modal-table a{
  color: black;
  text-decoration: none;
}
#modal-table a:visited{
  color: black;
}


#modal-table img
{
  max-width: 100%;
  width: 100%;
}
#modal-table i
{
  font-size: 30px;
}

#modalclose
{
  font-size: 25px;
    color: red;
}

  </style>
</head>
<body> 
		<!-- source src="https://www.dropbox.com/s/9f108u4irusk17q/ikea_edit.mp4?raw=1" type="video/mp4" -->

    <div id="videowrapper">
      <div style="margin: auto;
      position: relative; display: flex; height:100%;
    align-items: center;">

      <video id="ikeavideo" width="100%" autoplay muted loop playsinline style="position:absolute">
        <source src="https://www.dropbox.com/s/9f108u4irusk17q/ikea_edit.mp4?raw=1" type="video/mp4">
        Your browser does not support HTML video.
      </video>

      <div id="customcontrols" style="position:absolute;">
        <div id="logo" class="autohidable">
        <img src="imgs/ikeanimation.png" />
        <div id="currentchapterindicator"></div>
        </div>
        <!--<div id="customfullscreen" style="z-index: 90000; position:relative; top: 100px;" class="custom-control"><i class="fa-solid fa-expand"></i></div>
        <div class="custom-control"><i class="fa-solid fa-minimize"></i></div>-->

        <div id="playnav" class="autohidable">
        <div style="width:50%; text-align: center;"><div class="custom-control autohidable" id="previouslink"  style="display:inline-block; padding:5px; cursor: pointer;"><i  id="prevlinkBtn" class="fa-solid fa-backward-step" style="padding:7px;"></i><span id="prevlinkText"><!--PREVIOUS--></span></div></div>
        <div id="customplaypause" class="custom-control autohidable"><i id="playbutton" class="fa-solid fa-pause"></i></div>
        <div  style="width:50%; text-align: center;"><div class="custom-control autohidable" id="nextlink" style="display:inline-block; padding:5px; cursor: pointer;"><span id="nextlinkText"><!--Next--></span><i id="nextlinkBtn" class="fa-solid fa-forward-step"  style="padding:7px;"></i></div></div>
        </div>


        <div id="speedpanel" class="autohidable">
          <div id="speed05" class="custom-control speed-control autohidable" data-speed="0.5">0.5x</div>
          <div id="speed10" class="custom-control speed-control autohidable" data-speed="1.0">1.0x</div>
          <div  id="speed125" class="custom-control speed-control autohidable" data-speed="1.25">1.25x</div>
          <div  id="speed15" class="custom-control speed-control autohidable" data-speed="1.5">1.5x</div>
          <div  id="speed20" class="custom-control speed-control autohidable" data-speed="2.0">2.0x</div>
      </div>

      <div id="additionalLinksPanel" class="autohidable">
        <div><a href="micke.html" target="_blank"><i class="fa-solid fa-book-open"></i></a></div>
        <div><a href="micke-desk-oak-effect__AA-476633-11-2.pdf"><i class="fa-solid fa-file-pdf"></i></a></div>
        <div><a id="btnOpenModal" href="#"><i class="fa-solid fa-qrcode"></i></a></div>
        <div id="customfullscreen" style="z-index: 90000 /*;position: absolute;top: -47px;right: 0;*/" class="autohidable"><i id="fullscreenicon" class="fa-solid fa-expand"></i></div>        
      </div>

        <div class="custom-control progressbar autohidable">



          <div id="progresselapsed"><!--Elapsed--></div>
          <div id="progresstotal"><!--Total--></div>
          <div id="watchedbar"></div>
          <div id="chapterbar">

          </div>
          <i id="progressindicator" class="fa-solid fa-circle"></i>
        </div>


      </div>

</div>

      </div>

      <!--<div style="position:fixed; z-index:9000; top:0; right:500; background-color:chartreuse;" id="fullscreener">EXPERIMENT</div>-->

<!-- The Modal -->
<div id="myModal" class="modal">

  <!-- Modal content -->
  <div class="modal-content">
    <div><span id="modalclose" class="close"><i class="fa-solid fa-circle-xmark"></i></span></div>
    <div>
     <table id="modal-table">
      <tr>
        <td>
          <a href="micke.html" target="_blank">
          <img src="imgs/qr-flipbook.jpg" />
          </a>
        </td>
        <td>
          <a href="micke-desk-oak-effect__AA-476633-11-2.pdf">
          <img src="imgs/qr-pdf.jpg" />
          </a>
        </td>
      </tr>
      <tr>
        <td>
          <a href="micke.html" target="_blank">
          <i class="fa-solid fa-book-open"></i>
          </a>
        </td>
        <td>
          <a href="micke-desk-oak-effect__AA-476633-11-2.pdf">
          <i class="fa-solid fa-file-pdf"></i>
          </a>
        </td>
      </tr>
     </table>
    </div>
  </div>

</div>

      <script>
/*
if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {
 alert("mobile");
}
else
{
  alert("px");
}*/

  var ikeavideo = document.getElementById("ikeavideo");
  
  var duration_totaltime = document.getElementById("duration_totaltime");
  var progresstotal = document.getElementById("progresstotal");
  var progresselapsed = document.getElementById("progresselapsed");
  var progressindicator = document.getElementById("progressindicator");
  var chapterbar = document.getElementById("chapterbar");
  var customfullscreen = document.getElementById("customfullscreen");
  var fullscreenicon = document.getElementById("fullscreenicon");
  var videowrapper = document.getElementById("videowrapper");
  var currentchapterindicator = document.getElementById("currentchapterindicator");
  var btnOpenModal = document.getElementById("btnOpenModal");
  var myModal = document.getElementById("myModal");
  var modalClose = document.getElementsByClassName("close")[0];

  var previouslink = document.getElementById("previouslink");
  var prevlinkText = document.getElementById("prevlinkText");
  var nextlink = document.getElementById("nextlink");
  var nextlinkText = document.getElementById("nextlinkText");
  var prevlinkBtn = document.getElementById("prevlinkBtn");
  var nextlinkBtn = document.getElementById("nextlinkBtn");

  var speed05 = document.getElementById("speed05");
  var speed10 = document.getElementById("speed10");
  var speed125 = document.getElementById("speed125");
  var speed15 = document.getElementById("speed15");
  var speed20 = document.getElementById("speed20");
  var speeds = ["05", "10", "125", "15", "20"];

  speed05.onclick = function(){ setSpeed("05"); };
  speed10.onclick = function(){ setSpeed("10"); };
  speed125.onclick = function(){ setSpeed("125"); };
  speed15.onclick = function(){ setSpeed("15"); };
  speed20.onclick = function(){ setSpeed("20"); };

  previouslink.onclick = function(){ var info = getChapters(); if(info.previouslinktime > -1) { ikeavideo.currentTime =  info.previouslinktime } };
  nextlink.onclick = function(){ var info = getChapters(); if(info.nextlinktime > -1) { ikeavideo.currentTime =  info.nextlinktime } };

  var initialstatevideoplaying = false;
  btnOpenModal.onclick = function(){ initialstatevideoplaying = (!ikeavideo.paused && !ikeavideo.ended); pauseVideo();  myModal.style.display = "block"; };

  modalClose.onclick = function() {
    myModal.style.display = "none";
    if(initialstatevideoplaying)
    {
      playVideo();
    }
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == myModal) {
    myModal.style.display = "none";
    if(initialstatevideoplaying)
    {
      playVideo();
    }    
  }
}


  var readytoplay = false;

  //#videowrapper .custom-control, #videowrapper #logo, #videowrapper #playnav, #videowrapper .visiblenav, #videowrapper .visiblenav *
  //var autohideselector = "#videowrapper .custom-control, #videowrapper #logo, #videowrapper #playnav, #customplaypause, #videowrapper .visiblenav, #videowrapper .visiblenav *";
  var autohideselector = ".autohidable";
  $(document).on("touchend", function(){
    if(readytoplay)
    {
      $ (autohideselector).show();
      hideMenu(); //hide again after 2 seconds
    }
  });

  function hideMenu(){
    setTimeout( function(){
      $ (autohideselector).fadeOut(1500);
    }, 2000);
  }
  var timer; 

  $('body').mousemove(function() {
    if(readytoplay)
    {

      $ (autohideselector).show();
      clearTimeout(timer);
      timer=setTimeout(hideMenu,300);
    }
  });


  customfullscreen.onclick = function(){
    //videowrapper.requestFullscreen();
    if (document.fullscreenElement) {
		  document.exitFullscreen();
      fullscreenicon.classList.add("fa-expand");
      fullscreenicon.classList.remove("fa-minimize");
    } else {
      videowrapper.requestFullscreen();
      fullscreenicon.classList.add("fa-minimize");
      fullscreenicon.classList.remove("fa-expand");
    }    
  };

  function setSpeed(speed)
  {
    for (var s=0; s < speeds.length; s++)
    {
      var speedbtn = document.getElementById("speed" + speeds[s]);
      if(speed==speeds[s])
      {
        speedbtn.classList.add("activespeed");
        ikeavideo.playbackRate = speedbtn.getAttribute("data-speed");
      }
      else
      {
        speedbtn.classList.remove("activespeed");
      }
    }
  }

function resetHeight(){
    // reset the body height to that of the inner browser
    document.body.style.height = window.innerHeight + "px";
    document.getElementById("customcontrols").style.width = (ikeavideo.clientWidth)+"px"; 
    document.getElementById("customcontrols").style.height = (ikeavideo.clientHeight)+"px";
}
// reset the height whenever the window's resized
  window.addEventListener("resize", resetHeight);

        var chapters = [
            {
                label: "Beginning",
                time: 0
              },
              {
                label: "Parts & tools",
                  time: 9
              },
              {
                label: "Making the drawer",
                  time: 33
              },
              {
                label: "Making the table",
                  time: 87
              },
              {
                label: "Putting it all together",
                  time: 279
              },
              {
                label: "Design options",
                  time: 304
              }        
          ];
          
          function getChapters()
          {
            var chapterInfo = {
              previous: "",
              previouslinktime: -1,
              current: "",
              next: "",
              nextlinktime: -1
            };
            for(var c=0; c<chapters.length; c++)
            {
              if(ikeavideo.currentTime >= chapters[c].time)
              {
                  chapterInfo.current = chapters[c].label;
                  if(c>0)
                  {
                    chapterInfo.previous = chapters[c-1].label;
                    chapterInfo.previouslinktime = chapters[c-1].time;
                  }
                  if(c+1 < chapters.length && ikeavideo.currentTime < chapters[c+1].time)
                  {
                    chapterInfo.next = chapters[c+1].label;
                    chapterInfo.nextlinktime = chapters[c+1].time;
                  }                  
              }
            }
            //ikeavideo.currentTime

            return chapterInfo;
          }

          //play/pause
          //fullscreen/restore
          //click/tap on progressbar
          //drag progress circle
          //change speed
          //show progress

          // contols visible on hover
          // visible on tap
          //if touched - restart count
          ikeavideo.onplay = function() {
            $ (autohideselector).hide();
            $("#playnav *, .progressbar *").css({ visibility: "visible" });
          };
          
          ikeavideo.oncanplay = function () { 
            
            progresstotal.textContent = formatTime(ikeavideo.duration); 

            for (var c=0; c < chapters.length; c++)
            {
              if(chapters[c].time <= ikeavideo.duration)
              {
                var chapterdiv = document.createElement('div');
                chapterdiv.setAttribute("data-label", chapters[c].label);
                chapterdiv.setAttribute("data-jumpto", chapters[c].time);
                chapterdiv.className = "progress-chapter";
                chapterdiv.style.left = (chapters[c].time * 100 / ikeavideo.duration) + "%";
                chapterbar.appendChild(chapterdiv);
              }
            }
            resetHeight();
            readytoplay = true;
            console.log("controls are set");
            setSpeed("10");
          };
          
          ikeavideo.ontimeupdate = function () {
            progresselapsed.textContent = formatTime(ikeavideo.currentTime);
            var prcposition = (ikeavideo.currentTime * 100 / ikeavideo.duration) + "%";
            progressindicator.style.left = prcposition;
            watchedbar.style.width = prcposition;
            
            var cpt = getChapters();
            currentchapterindicator.textContent = cpt.current;
            /*
            prevlinkText.textContent = cpt.previous;
            nextlinkText.textContent = cpt.next;
            */
            if(cpt.previous)
            {
              previouslink.classList.add("visiblenav");//.style.visibility = "visible";
              prevlinkBtn.classList.add("visiblenav");
              prevlinkBtn.classList.add("visiblenav");
            }
            else
            {
              previouslink.classList.remove("visiblenav");//.style.visibility = "hidden";
              prevlinkBtn.classList.remove("visiblenav");
              prevlinkBtn.classList.remove("visiblenav");
            }
            if(cpt.next)
            {
              nextlink.classList.add("visiblenav");//.style.visibility = "visible";
              nextlinkBtn.classList.add("visiblenav");
              nextlinkBtn.classList.add("visiblenav");
            }
            else
            {
              nextlink.classList.remove("visiblenav");//.style.visibility = "hidden";
              nextlinkBtn.classList.remove("visiblenav");
              nextlinkBtn.classList.remove("visiblenav");
            }            

          }

          function formatTime(totalseconds)
          {
            remainingseconds = Math.floor(totalseconds);
            var hours = "00";
            var minutes = "00";
            if (remainingseconds >= 60*60) //more than an hour
            {
              var totalhours = Math.floor(remainingseconds/(60*60));
              remainingseconds -= totalhours*(60*60);
              hours = totalhours;
            }
            if(remainingseconds >= 60) //more than a minute
            {
              var totalminutes = Math.floor(remainingseconds/60);
              remainingseconds -= totalminutes*60;
              minutes = totalminutes;
            }
            return padnum(hours) + ":" + padnum(minutes) + ":" + padnum(remainingseconds);
          }

          function padnum(num)
          {
            var pad = "00";
            var numstr = pad + num; 
            var cutout_len = Math.max(num.toString().length, pad.length); 
            return numstr.substr(numstr.length - cutout_len, cutout_len);
          }

          var playButton = document.getElementById('playbutton');
          playButton.onclick = togglePlay;

          function togglePlay() {
          if (ikeavideo.paused || ikeavideo.ended) {
            playVideo();
          } else {
            pauseVideo();
          }
        }

          function playVideo()
          {
            ikeavideo.play();
            playButton.classList.remove("fa-play");
            playButton.classList.add("fa-pause"); 
          }

          function pauseVideo()
          {
            ikeavideo.pause();
            playButton.classList.add("fa-play");
            playButton.classList.remove("fa-pause");
          }



//========================================================

      </script>

</body> 
</html>